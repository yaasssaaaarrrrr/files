<!-- Main Image -->
<div class="mobile-main-image-wrapper">
  <img id="mainMobileImage" 
       src="{{ product.featured_image | img_url: '800x' }}" 
       alt="{{ product.title }}" 
       class="main-mobile-image" />
</div>

<!-- Thumbnails -->
<div class="mobile-only-product-gallery" id="mobileGallery">
  {% assign imageIndex = 0 %}
  {% for media in product.media %}
    {% if media.media_type == 'image' %}
      <div class="mobile-thumbnail-wrapper">
        <img 
          src="{{ media | img_url: '200x' }}" 
          data-index="{{ imageIndex }}"
          data-full="{{ media | img_url: '800x' }}"
          alt="{{ media.alt | escape }}" 
          class="mobile-thumbnail {% if forloop.first %}active{% endif %}" 
          onclick="updateMainMobileImage('{{ media | img_url: '800x' }}', this)"
        />
      </div>
      {% assign imageIndex = imageIndex | plus: 1 %}
    {% endif %}
  {% endfor %}
</div>

<style>
@media screen and (max-width: 749px) {
  .product-gallery,
  .product-gallery-block,
  .product__media-wrapper {
    display: none !important;
  }

  .mobile-main-image-wrapper {
    text-align: center;
    margin-bottom: 10px;
  }

  .main-mobile-image {
    max-width: 100%;
    border-radius: 10px;
    transition: transform 0.3s ease;
box-shadow: 0px 0px 9px 0px #0000003B;

  }

  .mobile-only-product-gallery {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding: 0 10px;
    margin-bottom: 20px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .mobile-only-product-gallery::-webkit-scrollbar {
    display: none;
  }

  .mobile-thumbnail-wrapper {
    flex: 0 0 auto;
  }

  .mobile-thumbnail {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 6px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border 0.2s;
  }

  .mobile-thumbnail.active {
    border-color: #000;
  }
}

@media screen and (min-width: 750px) {
  .mobile-only-product-gallery,
  .mobile-main-image-wrapper {
    display: none !important;
  }
}
</style>

<script>
let touchStartX = 0;
let touchEndX = 0;

const gallery = document.getElementById('mobileGallery');
const mainImage = document.getElementById('mainMobileImage');
let thumbnails = Array.from(document.querySelectorAll('.mobile-thumbnail'));
let currentIndex = 0;

function updateMainMobileImage(imageUrl, thumbnail = null) {
  if (mainImage) {
    mainImage.src = imageUrl;
  }
  thumbnails.forEach(img => img.classList.remove('active'));
  if (thumbnail) {
    thumbnail.classList.add('active');
    currentIndex = parseInt(thumbnail.dataset.index);
  }
}

function handleSwipe() {
  if (touchEndX < touchStartX - 50) {
    // Swipe left → next image
    if (currentIndex < thumbnails.length - 1) {
      currentIndex++;
      updateMainMobileImage(thumbnails[currentIndex].dataset.full, thumbnails[currentIndex]);
    }
  }
  if (touchEndX > touchStartX + 50) {
    // Swipe right → previous image
    if (currentIndex > 0) {
      currentIndex--;
      updateMainMobileImage(thumbnails[currentIndex].dataset.full, thumbnails[currentIndex]);
    }
  }
}

if (mainImage) {
  mainImage.addEventListener('touchstart', e => {
    touchStartX = e.changedTouches[0].screenX;
  });

  mainImage.addEventListener('touchend', e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });
}
</script>
